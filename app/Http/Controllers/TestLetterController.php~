<?php

namespace App\Http\Controllers;

use App\Helpers\Helper;
use App\Http\Requests\FormTestLetterRequest;
use App\Services\TestLetter\TestLetterService;
use Illuminate\Http\Request;

class TestLetterController extends Controller
{
    protected $testLetterService;
    public function __construct(TestLetterService $testLetterService)
    {
        $this->testLetterService = $testLetterService;
    }

    public function index()
    {
        $data['test_letters'] = $this->testLetterService->findAllByUserId(auth()->user()->id)->getResult();
        return view('apps.test-letter.index');
    }

    public function form($id = null)
    {
        if (auth()->user()->isGuest() && auth()->user()->isVerified()) {
            $data['test_letter'] = @$this->testLetterService->find($id)->getResult();
            return view('apps.test-letter.form', $data);
        }
    }

    public function upsert_form(FormTestLetterRequest $request)
    {
        if (auth()->user()->isAdmin()) {
            return abort(403);
        }

        $data = $request->only(['type',
            'sop_component_installation',
            'technical_drawing',
            'conversion_workshop_certificate',
            'electrical_diagram',
            'photocopy_stnk',
            'physical_inspection',
            'test_report',
            'id']);
        return $this->testLetterService->upsert_form($data)->toJson();
    }
}
